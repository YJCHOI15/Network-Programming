본 프로젝트는 **TCP 소켓 프로그래밍**을 기반으로 한 클라이언트-서버 구조의 프로그램입니다.  
멀티스레드를 활용하여 클라이언트 요청을 처리하고, 계산 결과를 모든 클라이언트에게 브로드캐스트합니다.

서버는 클라이언트 연결 시 새로운 스레드를 생성하며, 각 스레드는 클라이언트의 계산 요청을 해석한 후, 결과를 모든 클라이언트에게 전송합니다. 클라이언트는 ID 기반 요청을 보내고, 서버는 이를 바탕으로 결과 메시지를 작성하여 전체 전파합니다.

---

## hw8_client.c

### 동작 과정

1. **실행 및 인자 확인**
   - 실행 시 `IP PORT ID(4글자)`를 입력받습니다.
   - 예: `./client 127.0.0.1 9190 aaaa`
   - ID가 4글자가 아니면 다음과 같이 출력 후 종료됩니다:
     ```
     ID have to be 4
     ```

2. **서버 연결 후 멀티스레드 시작**
   - `send_msg` 스레드: 사용자 입력을 서버로 전송
   - `recv_msg` 스레드: 서버로부터 결과를 수신하여 출력

3. **Send 스레드**
   - 사용자로부터 아래와 같은 계산 형식 입력을 받음  
     예: `3 1 2 3 + +`
     - 첫 숫자: 피연산자 개수
     - 다음 숫자들: 피연산자
     - 이후: 연산자
   - `iovec` 구조체 사용:
     - `iov[0]`: ID (4글자)
     - `iov[1]`: 계산 데이터
   - `writev()`로 서버에 전송
   - 만약 operand count가 0 이하인 값이면 다음 메시지 출력 후 종료:
     ```
     Overflow Number(<값>) - Closed client
     ```

4. **Receive 스레드**
   - 서버로부터 메시지를 `read()`로 수신
   - 수신된 문자열을 그대로 출력

---

## hw8_server.c

### 실행 방법

`./server <PORT>` 형식으로 실행합니다.  
예: `./server 9190`

### 동작 과정

1. **서버 소켓 초기화**
   - 입력 받은 포트 번호로 TCP 서버 소켓 생성
   - 클라이언트 요청 수락을 대기하며, 새로운 요청이 오면 스레드를 생성

2. **스레드 생성 및 관리**
   - 각 클라이언트 연결 시 다음 처리 수행:
     - `pthread_mutex`로 공유 클라이언트 fd 배열 접근 제어
     - 배열에 클라이언트 소켓 fd 저장 및 개수 증가
     - 스레드를 생성하여 해당 fd 전달
     - `pthread_detach()`로 스레드 자원 자동 회수
     - 표준 출력에 다음 메시지 출력:
       ```
       Connected client Port: <클라이언트 포트>
       ```

3. **클라이언트 스레드 (워커 스레드) 처리**
   - 클라이언트로부터 `readv()`로 요청 수신
     - `iov[0]`: 4글자 ID
     - `iov[1]`: 계산 데이터
   - 수신한 요청을 해석하여 결과 메시지 생성  
     예: `[aaaa] 1+2+3=6`
   - 현재 연결된 모든 클라이언트에게 `write()`로 메시지 전송
   - 클라이언트 연결이 종료되면 `Closed client` 출력 후 해당 fd 제거

---

## 통신 흐름 요약

1. 클라이언트는 ID, 피연산자 수, 숫자들, 연산자들을 포함한 요청을 `writev()`로 서버에 전송
2. 서버 스레드는 `readv()`로 요청을 받아 해석
3. 결과 문자열을 생성하여 모든 클라이언트에게 브로드캐스트
4. 클라이언트는 `read()`로 결과를 받아 출력

---

## 빌드 및 실행결과

![Image](https://github.com/user-attachments/assets/94115022-0ac6-4d32-873f-8ddff1e84036)

---

## 주요 시스템 호출 및 개념

- `socket()`, `bind()`, `listen()`, `accept()`
- `pthread_create()`, `pthread_detach()`, `pthread_mutex_lock()`
- `readv()`, `writev()`
- `iovec` 구조체를 통한 다중 버퍼 송수신
- `mutex`로 다중 클라이언트 동시 접근 제어
- 클라이언트 ID 기반 결과 메시지 생성 및 전체 전송

---

## 기타 사항

- 서버는 클라이언트 연결 시마다 새로운 스레드를 생성하여 독립적으로 처리합니다.
- 서버 종료 시 별도 종료 절차는 없으며, 클라이언트 종료는 수동입니다.
- 서버는 현재 실행 중인 클라이언트 목록을 메모리 상에서 관리하며, 종료 시 모두 소멸됩니다.
